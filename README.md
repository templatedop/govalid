<div align="center">
  <img src="assets/govalid-icon.svg" alt="govalid" width="128" height="128">
  <h1>govalid</h1>
  <p><strong>Blazing fast, zero-allocation, type-safe validation for Go</strong></p>

  ![Go Version](https://img.shields.io/badge/Go-1.21+-blue.svg)
  ![License](https://img.shields.io/badge/license-MIT-green.svg)
  ![Build Status](https://img.shields.io/badge/build-passing-brightgreen.svg)
  [![Go Report Card](https://goreportcard.com/badge/github.com/sivchari/govalid)](https://goreportcard.com/report/github.com/sivchari/govalid)
</div>

---

## üöÄ Overview

govalid generates **type-safe validation code** from struct field markers. No reflection, no runtime overhead, just blazing fast validation.

## ‚ö° Why govalid?

### üéØ Performance Benefits
- **Zero allocations**: All validation functions perform zero heap allocations
- **5x to 44x faster**: Significantly outperforms reflection-based validators
- **Compile-time optimization**: Generated code is optimized by the Go compiler

### üë®‚Äçüíª Developer Experience
- **Type safety**: Validation functions are generated with proper types, eliminating runtime reflection
- **Early error detection**: Invalid validation rules are caught during code generation, not at runtime
- **No runtime dependencies**: Generated code has minimal external dependencies

### üîß Comprehensive Go Support
- **Full collection support**: Maps and channels work with size validators (not supported by most libraries)
- **CEL expressions**: Common Expression Language support for complex validation logic
- **Go zero-value semantics**: Proper handling of Go's zero values and nil states
- **Unicode-aware**: String validators properly handle Unicode characters

## üìä Performance Comparison

<div align="center">

| Feature | govalid | Reflection Validators |
|:-------:|:-------:|:--------------------:|
| **Performance** | `~1-14ns, 0 allocs` | `~50-700ns, 0-5 allocs` |
| **Type Safety** | ‚úÖ Generated functions | ‚ùå Runtime reflection |
| **Collections** | `slice, array, map, channel` | `slice, array only` |
| **Dependencies** | ‚úÖ Minimal | ‚ùå Heavy runtime deps |
| **Error Detection** | ‚úÖ During code generation | ‚ùå Runtime |
| **CEL Support** | ‚úÖ Full support | ‚ùå Limited/None |

</div>

## üì¶ Installation


Install the `govalid` command-line tool by one of supported ways:

Using `go install`:

# Defaults to latest @ and version to install specific release
```bash
go install github.com/sivchari/govalid/cmd/govalid
```

Or:

```bash
# Clone the repository
git clone https://github.com/sivchari/govalid.git

# Navigate to the project directory
cd govalid

# Install the tool
go install ./...
```


Verify the installation:

```bash
govalid -h
```

## üéØ Quick Start

### 1. Define Your Struct with Markers

Add validation markers as comments above individual fields:

```go
package main

//go:generate govalid ./main.go

type Person struct {
    // +govalid:required
    Name string `json:"name"`

    // +govalid:email
    Email string `json:"email"`

    // +govalid:gte=18
    // +govalid:lte=120
    Age int `json:"age"`
}
```

### 2. Generate Validation Code

Run `go generate` in your package directory:

```bash
go generate ./...
```

This generates validation code like:

```go
// Code generated by govalid; DO NOT EDIT.
import (
	"errors"
	"github.com/sivchari/govalid"
	govaliderrors "github.com/sivchari/govalid/validation/errors"
	"github.com/sivchari/govalid/validation/validationhelper"
)

var (
	// ErrNilPerson is returned when the Person is nil.
	ErrNilPerson = errors.New("input Person is nil")

	// ErrPersonNameRequiredValidation is returned when the Name is required but not provided.
	ErrPersonNameRequiredValidation = govaliderrors.ValidationError{Reason: "field Name is required", Path: "Person.Name", Type: "required"}

	// ErrPersonEmailEmailValidation is the error returned when the field is not a valid email address.
	ErrPersonEmailEmailValidation = govaliderrors.ValidationError{Reason: "field Email must be a valid email address", Path: "Person.Email", Type: "email"}
)

var _ govalid.Validator = (*Person)(nil)

func ValidatePerson(t *Person) error {
	if t == nil {
		return ErrNilPerson
	}

	var errs govaliderrors.ValidationErrors

	if t.Name == "" {
		err := ErrPersonNameRequiredValidation
		err.Value = t.Name
		errs = append(errs, err)
	}

	if !validationhelper.IsValidEmail(t.Email) {
		err := ErrPersonEmailEmailValidation
		err.Value = t.Email
		errs = append(errs, err)
	}

	if len(errs) > 0 {
		return errs
	}
	return nil
}

func (p *Person) Validate() error {
	return ValidatePerson(p)
}
```

### 3. Use Generated Validators

```go
func main() {
	p := &Person{Name: "John", Email: "invalid-email"}

	if err := ValidatePerson(p); err != nil {
		log.Printf("Validation failed: %v", err)
		// Output: Validation failed: field Email must be a valid email address
		if errors.Is(err, ErrPersonEmailEmailValidation) {
			log.Printf("Email validation failed, handle error as needed: %v", err)
		}
	}
}
```

#### 3.1 Handle multiple validation errors

In case of multiple validation errors, `govalid` generated validators will aggregate all errors and return a list
of structs that implement error interface.

```go
func main() {
	p := &Person{Name: "", Email: "invalid-email"}

	if err := ValidatePerson(p); err != nil {
		log.Printf("Validation failed: %v", err)

		if errors.Is(err, ErrPersonEmailEmailValidation) {
			log.Printf("First email error", err)
		}

		if errors.Is(err, ErrPersonNameRequiredValidation) {
			log.Printf("Second required error %v", err)
		}
	}
}
```

#### 3.2 Validator Interface
```go
func main() {
	p := &Person{Name: "John", Email: "invalid-email"}

	if err := p.Validate(); err != nil {
		log.Printf("Validation failed: %v", err)
	}
}
```

The generated `Validate()` method enables seamless integration with HTTP middleware:

```go
import (
	"net/http"
	"github.com/sivchari/govalid/validation/middleware"
)

func CreatePersonHandler(w http.ResponseWriter, r *http.Request) {
	w.Write([]byte("OK"))
}

func main() {
	http.HandleFunc("/person", middleware.ValidateRequest[*Person](CreatePersonHandler))
	http.ListenAndServe(":8080", nil)
}
```

## üîß Advanced Features

### Multiple Validators on a Field
Apply multiple validation rules to a single field:

```go
type Person struct {
    // +govalid:required
    // +govalid:minlength=3
    // +govalid:maxlength=50
    Name string

    // +govalid:gte=18
    // +govalid:lte=120
    Age int
}
```

### CEL Expression Support
Use Common Expression Language for complex validation:

```go
type User struct {
    // +govalid:cel=value >= 18 && value <= 120
    Age int

    // +govalid:cel=value >= this.Age
    RetirementAge int
}
```

### Collection Support
Validate slices, arrays, maps, and channels with size constraints:

```go
type UserData struct {
    // +govalid:maxitems=10
    // +govalid:minitems=1
    Users []User

    // +govalid:maxitems=100
    UserMap map[string]User

    // +govalid:unique
    Tags []string
}
```

### Nested Struct Validation with Dive
Validate nested structs in collections:

```go
type Address struct {
    // +govalid:required
    Street string

    // +govalid:required
    City string
}

type Person struct {
    // +govalid:required
    Name string

    // +govalid:dive
    Addresses []Address  // Validates each Address in the slice
}
```

### Conditional Validation
Fields can be required or excluded based on other field values:

```go
type Order struct {
    PaymentMethod string

    // Required only if PaymentMethod is "card"
    // +govalid:required_if=PaymentMethod card
    CardNumber string

    // Excluded if PaymentMethod is "cash"
    // +govalid:excluded_if=PaymentMethod cash
    OnlineTransactionID string
}
```

## üìù Supported Markers

<details>
<summary><strong>üìñ View Complete Marker Reference</strong></summary>

For a complete reference of all supported markers, see [MARKERS.md](MARKERS.md).

**Numeric Validators:**
- `required` - Field must not be zero value
- `gt`, `gte`, `lt`, `lte` - Greater than, greater/equal, less than, less/equal
- `min` - Minimum value (inclusive)
- `eq` - Equals specific value
- `ne` - Not equals specific value

**String Validators:**
- `maxlength`, `minlength`, `length` - String length validation
- `alpha` - Alphabetic characters only
- `alphanum` - Alphanumeric characters only
- `lowercase` - Must be all lowercase
- `oneof` - Value must be one of specified options
- `containsany` - Must contain any of specified characters
- `excludes` - Must not contain substring
- `excludesall` - Must not contain any of specified characters

**Collection Validators:**
- `maxitems`, `minitems` - Collection size validation
- `unique` - All elements must be unique

**Format Validators:**
- `email`, `url`, `uuid` - Standard format validation
- `uri` - URI format validation
- `fqdn` - Fully Qualified Domain Name
- `ipv4`, `ipv6` - IP address validation
- `latitude`, `longitude` - Geographic coordinate validation
- `iscolour` - Color format (hex, rgb, rgba, hsl, hsla, named)
- `number`, `numeric` - Numeric string validation
- `boolean` - Boolean string validation

**Type Validators:**
- `isdefault` - Must be zero/default value
- `enum` - Enumeration validation

**Duration Validators:**
- `minduration`, `maxduration` - Time duration constraints

**Conditional Validators:**
- `required_if`, `required_unless` - Conditional required based on other field value
- `required_with`, `required_with_all` - Required when other fields present
- `required_without`, `required_without_all` - Required when other fields absent
- `excluded_if`, `excluded_unless` - Conditional exclusion based on other field value
- `excluded_with`, `excluded_with_all` - Excluded when other fields present
- `excluded_without`, `excluded_without_all` - Excluded when other fields absent

**Advanced:**
- `cel` - Common Expression Language support for complex expressions
- `date` - Date format validation (dd/mm/yy)
- `dive` - Validate nested structs in collections
- Cross-field validation with conditional validators

</details>

## üöÄ Performance Benchmarks

govalid consistently outperforms reflection-based validators by **5x to 44x**:

<div align="center">

| Validator | govalid | go-playground | Improvement |
|:---------:|:-------:|:-------------:|:-----------:|
| Required | `1.9ns` | `85.5ns` | **44.2x** |
| GT/LT | `1.9ns` | `63.0ns` | **32.5x** |
| MaxLength | `15.7ns` | `73.5ns` | **4.7x** |
| Email | `38.2ns` | `649.4ns` | **17.0x** |

*All with **0 allocations** vs competitors' 0-5 allocations*

</div>

### üî• Dive Performance Optimization

The `dive` directive for nested collection validation is optimized to consolidate multiple validators into a single loop:

- **Before:** O(n √ó m) - separate loops for each validator
- **After:** O(n) - single consolidated loop
- **Result:** Up to **5x faster** for collections with multiple validators

Example: 1,000 elements with 5 validators = 5,000 iterations ‚Üí 1,000 iterations

[üìä View Complete Benchmarks](test/benchmark/README.md)

### üîß Development Setup

For contributors, install lefthook to enable pre-commit checks:

```bash
make install-lefthook
```

Because of this, lefthook is installed, then the code-base would be checked automatically before each commit, ensuring code quality and consistency.

## üìÑ License

MIT License - see [LICENSE](LICENSE) file for details.

---

<div align="center">
  <sub>Built with ‚ù§Ô∏è for the Go community</sub>
</div>
